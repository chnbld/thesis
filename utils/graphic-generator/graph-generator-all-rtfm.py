import os
from c3d import *
from classifier import *
from utils.visualization_util import *
import sys
import glob

original_stdout=sys.stdout

def run_demo(num):
    #C:\Users\dalab\Documents\Graduation work4\videos\was testing
    video="C:/Users/dalab/Documents/Graduation work4/videos/was testing/"+num+".mp4"
    video_name = os.path.basename(video).split('.')[0]
    logits={}
    logits['004']=[2.3406535e-10, 3.931133e-10, 2.8130021e-11, 2.3184958e-09, 6.010238e-08, 7.796894e-09, 9.947531e-09, 1.3090542e-05, 5.832276e-06, 0.00019944, 0.00067093, 0.00090106, 3.0842017e-08]
    logits['005']=[0.04508115, 0.00091994, 0.01483042, 0.04539835, 0.075984, 0.04803829, 0.01160484, 0.00479794, 0.0012426, 0.00041385, 0.00240504, 0.00207723, 0.00756917, 0.00559967, 0.00177808, 0.01196094, 0.05283134, 0.12695393, 0.15354829, 0.5043831, 0.08027861, 0.05528597, 0.1089262, 0.03536647, 0.01200749, 0.01834456, 0.1291928, 0.4114046, 0.05715434, 0.01173227, 0.01015875, 0.0145857]
    logits['006']=[0.00016999, 0.00013329, 0.00051724, 2.1691667e-05, 5.5005443e-05, 8.8221954e-05, 2.9406456e-06, 1.4254287e-05, 6.0646007e-06, 1.0522821e-06, 1.1603772e-06, 3.7992406e-05, 5.60342e-06, 0.00010521, 6.193918e-05, 0.01498127, 0.01421672, 0.00132758, 0.00212299, 3.0816653e-05, 0.00037136, 4.8948954e-05, 6.533766e-05]
    logits['007']=[0.0001755, 0.00070966, 9.7539916e-05, 0.00979559, 0.00779857, 0.0012215, 0.21249618, 0.09189954, 0.00025936, 0.00222594, 0.07057495, 0.15731886, 0.09796242]
    logits['008']=[0.18805452, 0.45902956, 0.158751, 0.06249379, 0.0006002, 0.00058798, 0.00020307, 7.7642064e-05, 4.1721574e-07, 4.329693e-10] 
    logits['009']=[0.9513997, 0.24494967, 0.51169413, 0.25876376, 0.22875753, 0.85766715, 0.94943184, 0.9423344, 0.93864083, 0.9846544, 0.9662161, 0.9870545, 0.9621252, 0.8897506, 0.7689145, 0.08936477, 0.49883464, 0.90875554, 0.82695824, 0.33849093, 0.4106839, 0.6861111, 0.82526016, 0.3030132, 0.45836073, 0.17959295, 0.28843158, 0.579819, 0.06940864, 0.1086891, 0.4163834, 0.2520843, 0.20652498, 0.8481169, 0.95985, 0.92188966, 0.87068176, 0.4707358, 0.9338207, 0.41016003, 0.54748553, 0.59498566, 0.3635096, 0.68560797, 0.9010503, 0.97554773, 0.68471515, 0.4236452, 0.49521622, 0.34644806, 0.37214667, 0.81689554, 0.33812013, 0.08446668, 0.08142613, 0.08007359, 0.12145074]
    logits['010']=[0.6127075, 0.0080338, 0.00489988, 0.00314453, 0.02345457, 0.0013635, 0.00021206, 0.00032729, 0.00454576, 0.2157733, 0.02369745, 0.00959183, 0.01986023, 0.026766, 0.14125101, 0.00218619, 0.00093378, 0.00053067, 0.00161402, 0.00301203, 0.00991399, 0.00023196, 0.01421584, 0.00466389, 0.00561996, 6.207932e-06, 0.00092852, 0.00107789, 0.0015217, 0.03532827, 0.03506025, 0.06203023, 0.0195838, 0.02266968, 0.00765374, 0.00224197, 0.10453257, 0.04950255, 0.01396372, 0.00497919, 0.00553503, 0.02786605, 0.00949276, 0.00136697, 0.00491094, 0.04461361, 0.01991572, 0.10322144, 0.01000619, 0.09884537, 0.0843235, 0.03641983, 0.06154492, 0.02216706, 0.0072526, 0.04865085, 0.12457302, 0.02139972, 0.0368656, 0.03282121, 0.02327215, 0.02391939, 0.01233749, 0.02663214, 0.01114447, 0.01896019, 0.00464418, 0.00182945, 0.00308092, 0.01419804, 0.03536976, 0.0941606, 0.00778824, 0.02844177, 0.02961976, 0.00862082, 0.01137375, 0.01904102, 0.01886206, 0.00371271, 0.00735929, 0.00698461, 0.02142108, 0.05558093, 0.04186464, 0.07255478, 0.11967269, 0.06481574, 0.05354901, 0.04773139, 0.00487708, 2.1211388e-05, 0.00020864, 9.322688e-05, 0.0057625, 0.00697185, 0.00655328, 0.00088145, 0.0085667, 0.00711614, 0.01235209, 0.01235465, 0.01093797, 0.00088904, 0.00030878, 0.00512485, 0.0023357, 0.00144254, 0.00352738, 0.01052655, 0.01949361, 0.07136852, 0.07843622, 0.00680624, 0.00869418, 0.00136791, 0.00113701, 0.00023988, 0.00057472, 0.00197263, 0.01686318, 0.02446314, 0.00119705, 0.00027658, 0.00146597, 0.00190546, 0.0614258, 0.29120016, 0.05788113, 0.01522534, 0.00568237, 0.00877223, 0.40885702, 0.06358447, 0.00481033, 0.00228302, 0.00380104, 0.12242664, 0.05312464, 0.02600369, 0.01938916, 0.02909585, 0.02934633, 0.00282315, 0.01475192, 0.18358237, 0.00373699, 0.01830141, 0.00015394, 0.00027934, 0.00042301, 0.00026075, 2.3093071e-05, 5.6319772e-05, 0.00074699, 0.02173148, 0.0104648, 0.00067168, 6.651375e-05, 0.00128578, 0.00184389, 0.00180842, 0.00092923, 0.00091816, 0.00022042, 5.7131776e-05, 0.00015082]
    logits['011']=[0.7824411, 0.9361382, 0.9715217, 0.74639547, 0.9367327, 0.00149229, 0.06134437, 0.00150581, 0.00761733, 1.6530906e-09, 4.644166e-08, 0.0006136, 0.06419063, 3.9150527e-06, 0.00011466, 0.01075842, 0.00036047, 1.9977451e-06, 1.0545219e-05, 0.00139262, 0.01181552, 0.01044002, 0.00063535, 0.03280779, 0.907107, 0.6783575, 0.99467176, 0.9996025, 0.90039563, 0.00313201, 0.33779114, 0.03458668, 3.0606554e-06, 9.929806e-07, 0.00609178, 3.6730153e-06, 3.7975394e-07, 6.7252955e-08, 2.3719773e-11, 9.6589304e-08] 
    logits['012']=[4.9507318e-05, 3.984434e-05, 8.928713e-06, 3.6417846e-06, 0.00011666, 0.00055348, 0.00028433, 1.2230969e-06, 5.3025093e-07] 
    logits['013']=[0.82514197, 0.45153353, 0.2731674, 0.9159645, 0.777878, 0.8798948, 0.95366997, 0.14686452, 0.05513908] 
    logits['014']=[0.9958578, 0.20907918, 0.18163659, 0.01197091, 4.481357e-05, 0.00024092, 9.732102e-05, 0.9154783, 0.700574] 
    logits['029']=[0.999951, 0.9952507, 0.9776348, 0.99628156, 0.9997774, 0.99998057, 0.9998192, 0.99986696, 0.9992086, 0.9996117, 0.9999244, 0.99040985, 0.99967575, 0.99984324, 0.999858, 0.9999206, 0.99995697, 0.9998629, 0.99973124, 0.99971503, 0.9996842, 0.99967957, 0.99909174, 0.9945874, 0.9920941, 0.99437606, 0.99282235, 0.99157035, 0.99379694, 0.9904767, 0.9967872]
    logits['034']=[0.9920298, 0.993479, 0.99470997, 0.9933803, 0.9817613, 0.98800546, 0.99321437, 0.9936008, 0.9960425]
    logits['035']=[0.00611628, 0.00075756, 0.11810395, 0.9572593, 0.98123217, 0.9827168, 0.99292165, 0.9360331, 0.44239122, 0.7445918] 
    logits['045']=[0.07662005, 0.14620917, 0.29039365, 0.82681006, 0.979759, 0.94963294, 0.8474614, 0.97880095, 0.91946566, 0.981275, 0.9752333, 0.9766749, 0.9773037, 0.9739318, 0.9075386, 0.93548477, 0.91764873, 0.8579351, 0.84999204, 0.9873673] 
    logits['050']=[0.9674169, 0.9168405, 0.8804967, 0.9711592, 0.96645, 0.9812044, 0.9369243, 0.9243626, 0.9351491, 0.86960924, 0.9057754, 0.875758, 0.8236165, 0.9027881, 0.9750025, 0.8842179, 0.8373412, 0.9273098, 0.82413197, 0.90884995, 0.8935713] 
    logits['107']=[0.996418, 0.99753535, 0.9986796, 0.99530053, 0.9991304, 0.9998178, 0.9991763, 0.997917, 0.99846494, 0.9970298, 0.9975057, 0.9976646, 0.9988783, 0.9992611, 0.99698895, 0.9930052, 0.9974833, 0.9971312, 0.99614245, 0.99946874, 0.9991731, 0.99976844, 0.9997788, 0.99985707, 0.9985656, 0.99272037] 
    logits['201']=[0.99832124, 0.99991024, 0.9997868, 0.9997981, 0.9992969, 0.99866474, 0.99919516, 0.99931765, 0.99969804, 0.99926656, 0.9998265, 0.99979836, 0.9998211, 0.99960893, 0.99910957, 0.9993759, 0.998744, 0.9991002, 0.9988996] 
    logits['210']=[0.99977607, 0.997552, 0.9993069, 0.9981206, 0.9994609, 0.9995084, 0.9992035, 0.99884593, 0.9982102] 
    logits['211']=[0.9999244, 0.99979526, 0.99978393, 0.99998677, 0.9999571, 0.99905056, 0.9998041, 0.9998029, 0.99997103, 0.99990904, 0.9999256] 
    logits['212']=[0.9990765, 0.99575764, 0.99937767, 0.99943954, 0.9990048, 0.9987822, 0.99613535, 0.9949393, 0.9986082] 
    logits['213']=[0.9865889, 0.9988481, 0.9985927, 0.9985275, 0.99776936, 0.99768794, 0.9980506, 0.9967823, 0.9964675]
    logits['214']=[0.02292411, 0.07503113, 0.988636, 0.9784822, 0.95755404, 0.37668332, 0.8663053, 0.93028134, 0.9905731] 
    logits['215']=[1., 1., 1., 1., 0.9999999, 1., 0.9999999, 0.9999999, 0.99999964]
    logits['216']=[0.9999964, 0.9999994, 0.99999475, 0.9999751, 0.999944, 0.9999943, 0.99996436, 0.9999496, 0.99996245]
    logits['217']=[0.99933213, 0.9993961, 0.99963474, 0.9993192, 0.9985078, 0.9988726, 0.99972266, 0.99924767, 0.9996476]
    logits['218']=[0.9449109, 0.996436, 0.999423, 0.9972625, 0.9731169, 0.98690784, 0.99595684, 0.9995159, 0.9999032]
    logits['219']=[0.99987257, 0.9999701, 0.9999547, 0.999984, 0.99999034, 0.9999956, 0.99999714, 0.9999777, 0.99995315, 0.9998087, 0.9998227, 0.99852777, 0.9927182]
    logits['220']=[0.9914431, 0.9869615, 0.976785, 0.99013674, 0.9973883, 0.9978885, 0.99554825, 0.9937988, 0.98270863]
    logits['221']=[0.99775594, 0.9999666, 0.9999101, 0.99992275, 0.999941, 0.99998295, 0.9988686, 0.9983866, 0.99621224]
    logits['222']=[0.99994063, 0.99980205, 0.99968874, 0.99933165, 0.9998053, 0.9999217, 0.99910223, 0.99964166, 0.99991906]

    # read video
    video_clips, num_frames = get_video_clips(video)

    print(num)
    print("Number of clips in the video : ", len(video_clips))

    # classify using the trained classifier model
    predictions = np.array(logits[num])
    #classifier_model.predict(rgb_feature_bag)

    #predictions = np.array(predictions).squeeze()

    predictions = extrapolate(predictions, num_frames)

    save_path = "C:/Users/dalab/Documents/Graduation work4/videos/was testing/output/"+num+"-rtfm.mp4"
    # visualize predictions
    print('Executed Successfully - '+video_name + '.gif saved')
    visualize_predictions(video, predictions, save_path,num)


if __name__ == '__main__':
    
    videos=['004','005','006','007','008','009','010','011','012','013','014','029','034','035','045','050','107','201','210','211','212','213','214','215','216','217','218','219','220','221','222']
    for video in videos:
        run_demo(video)