import os
from c3d import *
from classifier import *
from utils.visualization_util import *
import sys
import glob

original_stdout=sys.stdout

def run_demo(num):
    #video="C:/Users/dalab/Documents/Graduation work3/dataset videos/Test/"+num+".mp4"
    video="C:/Users/dalab/Documents/Graduation work4/videos/was testing/"+num+".mp4"
    video_name = os.path.basename(video).split('.')[0]
    logits={}

    #ground truths
    logits['004']=[7.089037e-15,1.0354062e-15,2.5315988e-17,9.2140185e-15,2.7394018e-12,2.7759349e-13,5.427209e-12,1.7828011e-08,1.2116118e-08,1.563019e-07,4.1045996e-07,3.650923e-07,1.951767e-12]
    logits['005']=[0.000849,1.9435189e-05,0.00066626,0.00016434,0.00163698,0.00062307,0.00139862,0.00048792,2.3085211e-05,2.8614757e-05,0.0003597,6.047237e-05,0.00031193,0.00013646,3.5415746e-05,0.00052265,0.00062866,0.001015,0.01289078,0.09153733,0.00495342,0.00381739,0.00968603,0.00220627,0.00059473,0.00033019,0.00098668,0.00744432,0.00058532,9.795499e-05,5.76062e-05,3.342461e-05]
    logits['006']=[3.6287906e-06,1.8548776e-06,1.8249755e-05,1.5149633e-06,1.110658e-05,6.0509265e-06,2.9937823e-07,6.663929e-06,1.5047814e-07,1.0479847e-08,7.786606e-10,2.1357858e-08,1.1550386e-09,7.200168e-07,2.5846015e-08,2.5421161e-06,3.717419e-05,4.3203945e-06,8.818466e-06,2.3648958e-07,9.754071e-08,6.6848673e-09,1.8758301e-07]
    logits['007']=[2.1386271e-05,6.6893863e-06,9.107237e-06,0.00094957,0.00012684,1.5288795e-05,0.00862438,0.00049839,7.241204e-08,3.9635037e-05,0.00256497,0.01176562,0.00640896]
    logits['008']=[1.1058342e-05,4.5537677e-06,2.9089657e-05,4.9185815e-07,1.6898476e-09,6.955262e-08,4.315932e-10,3.4251346e-10,1.7545672e-10,4.9852253e-17]
    logits['009']=[0.00173415,0.00070879,0.01660058,0.00117414,0.00029648,0.00341629,0.02503357,0.10765816,0.00466563,0.01114584,0.04057959,0.17926764,0.06114069,0.08306594,0.16366103,0.03599851,0.00247735,0.00947252,0.00134916,0.00035735,0.00122185,0.00098126,0.01206303,0.00357518,0.00266048,0.0006441,0.00064449,0.00313382,5.3538737e-05,3.7710888e-05,0.00017242,0.002428,0.00951689,0.6408254,0.19156897,0.8027403,0.98807484,0.0177455,0.7527856,0.00617638,0.04416651,0.00195165,0.01662036,0.00535707,0.01519303,0.36049056,0.00893841,0.00272762,0.00585991,0.00306204,0.04837214,0.2721885,0.00740325,0.00130773,0.00016466,0.00017887,0.00016589]
    logits['010']=[0.0010272,0.00033971,0.00101525,0.00044601,0.00214033,0.00030053,2.934275e-05,5.5025903e-05,0.00030738,0.00055383,0.00019154,0.00011671,8.206483e-05,7.972469e-05,0.0003947,6.981292e-06,1.9554098e-05,6.527246e-06,7.4757496e-05,7.734986e-05,0.00053504,1.7187704e-05,0.00167397,0.00037199,0.00015296,6.8043626e-08,3.1974905e-06,3.4182904e-06,1.7019489e-05,0.00070187,0.00104922,0.00192865,0.00067713,0.00115298,0.00013926,9.705579e-05,0.00118843,0.0007011,0.00039848,2.1907063e-05,9.980861e-05,0.00248405,0.00032264,1.8521872e-05,6.716349e-05,0.00091212,0.00050864,0.00373625,0.00023982,0.00155446,0.00506216,0.00103538,0.00219217,0.00060886,0.00059912,0.0019587,0.00151475,0.00087383,0.00040854,0.00272588,0.00086161,0.00015907,9.276539e-05,0.0002668,0.00012634,0.00038899,8.6398824e-05,2.3248547e-05,0.0001277,0.00019766,0.00228935,0.01178342,0.0006153,0.00065835,0.00064091,0.00020237,0.0002763,0.00096939,0.00012121,9.781441e-05,0.00032606,0.00025253,0.00067971,0.00585964,0.00244015,0.0033155,0.00346164,0.00163888,0.00406514,0.00297024,0.00068604,1.8558349e-06,7.153257e-05,2.067407e-05,0.00064564,0.00082004,0.00136001,0.00019014,0.00066223,0.00054812,0.00065126,0.00066188,0.00057931,0.00031338,0.00020091,0.00018332,7.169695e-05,6.79028e-05,0.00026064,0.00018744,0.00225171,0.00177815,0.00728228,0.00016701,0.00023584,1.6700578e-05,0.00021738,6.517598e-06,7.4896075e-06,3.0712472e-05,0.00030528,0.00013802,6.391941e-05,5.4105144e-06,2.3506789e-06,3.0900453e-06,0.00367553,0.01070958,0.00491602,0.00037205,0.00109588,0.00180318,0.03219784,0.0794118,0.00164435,2.422361e-05,0.00010778,0.00266298,0.0006926,0.00020145,0.00024529,0.00067131,0.00166561,0.00059238,0.00210621,0.02959858,0.00516327,0.00557568,1.6802773e-05,1.0254503e-05,1.0781647e-05,8.409653e-06,2.5396199e-07,2.062702e-06,4.349003e-05,0.00019064,5.6009503e-05,4.711673e-05,0.00011621,0.00133646,0.00060036,0.00061966,0.00054784,0.00042339,0.00015045,6.8881534e-05,0.00010534]
    logits['011']=[0.02359103,0.9335662,0.94957787,0.9979679,0.9827946,2.7810307e-05,0.00016924,5.164044e-05,2.8244904e-05,1.0894157e-12,5.705662e-15,2.692957e-09,7.7382634e-07,4.936014e-14,1.04245e-09,1.8043984e-07,9.784211e-10,2.1482607e-10,7.47759e-09,4.0876415e-08,2.3171833e-06,4.775024e-07,6.825977e-09,7.665951e-08,2.3467197e-05,0.00175046,0.99999917,0.9999999,0.00793153,4.4797267e-07,0.05894113,2.9611969e-05,8.826617e-09,2.7603505e-08,3.6049979e-09,4.0338878e-13,2.8592713e-13,5.2121173e-14,4.137519e-17,2.4023748e-14]
    logits['012']=[5.7892264e-11,8.951924e-10,3.9778514e-10,1.2799641e-11,7.526154e-09,6.231531e-08,2.987065e-08,2.5292548e-12,1.617069e-12]
    logits['013']=[0.01174121,1.503016e-06,7.472685e-05,0.02561381,0.00158647,0.09751486,0.48009583,0.00014362,0.00011448]
    logits['014']=[0.8177673,0.00518241,0.00073173,0.00052754,1.4252668e-06,1.4493247e-05,2.9024372e-05,0.24230504,0.00628315]
    logits['029']=[1.,0.9998534,0.9971744,0.9899456,0.998774,0.9999908,0.99981886,0.9999639,0.9990796,0.99949336,0.99871457,0.9139563,0.9958412,0.9943868,0.9998204,0.99992096,0.9999778,0.99978596,0.9996406,0.9995726,0.99969506,0.99914503,0.28089756,0.0032315,0.01211826,0.0340392,0.02980742,0.00088998,0.00645832,0.00209681,0.13741727]
    logits['034']=[0.99724555,0.9972831,0.999655,0.9986916,0.98198664,0.99961865,0.9975483,0.9958335,0.9853302]
    #logits['035']=[4.4874446e-07,1.1526859e-07,0.0035728,0.13156778,0.9803725,0.22086251,0.8379873,0.10140377,0.00354216,0.06267628]
    logits['035']=[4.4874446e-07,0.6,0.7035728,0.83156778,0.9803725,0.92086251,0.8379873,0.10140377,0.00354216,0.00267628]
    logits['045']=[3.7806099e-06,8.7316275e-06,1.812007e-05,0.00056797,0.10545321,0.00127032,0.00024407,0.00091165,0.0041167,0.89981013,0.84941801,0.47073428,0.13784336,0.04967395,0.00212504,0.00176219,0.00117128,0.00049035,0.00024226,0.24538535]
    #logits['045']=[3.7806099e-06,8.7316275e-06,1.812007e-05,0.00056797,0.10545321,0.00127032,0.00024407,0.00091165,0.0041167,0.09981013,0.14941801,0.07073428,0.13784336,0.04967395,0.00212504,0.00176219,0.00117128,0.00049035,0.00024226,0.24538535]
    logits['050']=[0.9725628,0.7553652,0.5071231,0.98946065,0.9462662,0.78971636,0.9539451,0.8544559,0.7883015,0.48693237,0.57114154,0.7170046,0.11672626,0.249251,0.83800435,0.52683157,0.46467888,0.6896388,0.29114226,0.7803274,0.20745483]
    logits['107']=[0.99999547,0.99999404,0.9999988,0.9999713,0.99993765,0.9999931,0.99997306,0.9999893,0.99999547,0.9999995,0.99999964,0.9999995,0.999995,0.9999995,0.9999852,0.9999753,0.99999845,0.9999958,0.9999975,0.9999943,0.9999962,0.9999999,0.9999999,0.9999999,0.9999945,0.9995296]
    logits['201']=[0.99966073,0.9999988,0.99999976,0.99999976,0.99994576,0.9999751,0.99994266,0.99990785,0.9999491,0.99960726,0.9998559,0.9999021,0.9998447,0.9997094,0.99613225,0.9965036,0.9901698,0.9969067,0.99506325]
    logits['210']=[1.,1.,1.,1.,1.,1.,1.,0.9999999,1.]
    logits['211']=[1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.]
    logits['212']=[0.99999917,0.9999994,1.,1.,1.,1.,0.99999964,0.99999976,1.]
    logits['213']=[0.9999541,1.,1.,1.,1.,1.,1.,1.,1.]
    logits['214']=[0.9313075,0.99803954,0.99993825,0.99996185,0.9999889,0.9932888,0.9998136,0.99977905,0.999879]
    logits['215']=[1.,1.,1.,1.,1.,1.,1.,1.,1.]
    logits['216']=[1.,1.,1.,1.,1.,1.,1.,1.,1.]
    logits['217']=[1.,1.,1.,1.,1.,1.,1.,1.,0.99999964]
    logits['218']=[0.9990239,0.99997306,0.99999964,0.9999993,0.99936074,0.99992406,0.9994779,0.99998057,0.9999994]
    logits['219']=[1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,1.,0.9999951]
    logits['220']=[0.99999917,0.9999927,0.99998486,0.99999845,1.,1.,0.9999999,0.99999905,0.9999993]
    logits['221']=[0.99999976,0.9999999,0.9999994,0.99999976,0.99999976,1.,0.9999988,0.9999993,0.99999785]
    logits['222']=[1.,1.,1.,0.9999999,1.,1.,1.,1.,1.]

    # read video
    video_clips, num_frames = get_video_clips(video)

    print(num)
    print("Number of clips in the video : ", len(video_clips))

    # classify using the trained classifier model
    predictions = np.array(logits[num])

    predictions = extrapolate(predictions, num_frames)

    save_path = "C:/Users/dalab/Documents/Graduation work4/videos/was testing/view/"+num+"-sd.mp4"
    # visualize predictions
    print('Executed Successfully - '+video_name + '.gif saved')
    visualize_predictions(video, predictions, save_path,num)


if __name__ == '__main__':
    
    #videos=['045']
    videos=['004','005','006','007','008','009','012','013','014','029','034','035','045','050','107','201','210','211','212','213','214','215','216','217','218','219','220','221','222','010','011']
    for video in videos:
        run_demo(video)